{
  "hash": "1c87fd92ab65e6cffde516a580f54eef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take_home_Ex03\"\nauthor: \"Zou Jiaxun\"\ndate: \"Jun 7, 2024\"\ndata-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n## 1 Getting Start\n\n### 1.1 Package Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, readtext, skimr, knitr,\n               quanteda, tidytext, jsonlite, dplyr,\n               tidyr, tidygraph, ggraph, igraph,\n               visNetwork, ggplot2, gganimate, gridExtra)\n```\n:::\n\n\n## 2 Data Wangling\n\n### 2.1 Data Import\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_data <- fromJSON(\"data/MC3/mc3 1.json\")\nclass(mc3_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"list\"\n```\n\n\n:::\n:::\n\n\n### 2.2 Data Check\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges <- as_tibble(mc3_data$link)\nglimpse(mc3_edges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 75,817\nColumns: 11\n$ start_date          <chr> \"2016-10-29T00:00:00\", \"2035-06-03T00:00:00\", \"202…\n$ type                <chr> \"Event.Owns.Shareholdership\", \"Event.Owns.Sharehol…\n$ `_last_edited_by`   <chr> \"Pelagia Alethea Mordoch\", \"Niklaus Oberon\", \"Pela…\n$ `_last_edited_date` <chr> \"2035-01-01T00:00:00\", \"2035-07-15T00:00:00\", \"203…\n$ `_date_added`       <chr> \"2035-01-01T00:00:00\", \"2035-07-15T00:00:00\", \"203…\n$ `_raw_source`       <chr> \"Existing Corporate Structure Data\", \"Oceanus Corp…\n$ `_algorithm`        <chr> \"Automatic Import\", \"Manual Entry\", \"Automatic Imp…\n$ source              <chr> \"Avery Inc\", \"Berger-Hayes\", \"Bowers Group\", \"Bowm…\n$ target              <chr> \"Allen, Nichols and Thompson\", \"Jensen, Morris and…\n$ key                 <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ end_date            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes <- as_tibble(mc3_data$nodes)\nglimpse(mc3_nodes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,520\nColumns: 15\n$ type                <chr> \"Entity.Organization.Company\", \"Entity.Organizatio…\n$ country             <chr> \"Uziland\", \"Mawalara\", \"Uzifrica\", \"Islavaragon\", …\n$ ProductServices     <chr> \"Unknown\", \"Furniture and home accessories\", \"Food…\n$ PointOfContact      <chr> \"Rebecca Lewis\", \"Michael Lopez\", \"Steven Robertso…\n$ HeadOfOrg           <chr> \"Émilie-Susan Benoit\", \"Honoré Lemoine\", \"Jules La…\n$ founding_date       <chr> \"1954-04-24T00:00:00\", \"2009-06-12T00:00:00\", \"202…\n$ revenue             <dbl> 5994.73, 71766.67, 0.00, 0.00, 4746.67, 46566.67, …\n$ TradeDescription    <chr> \"Unknown\", \"Abbott-Gomez is a leading manufacturer…\n$ `_last_edited_by`   <chr> \"Pelagia Alethea Mordoch\", \"Pelagia Alethea Mordoc…\n$ `_last_edited_date` <chr> \"2035-01-01T00:00:00\", \"2035-01-01T00:00:00\", \"203…\n$ `_date_added`       <chr> \"2035-01-01T00:00:00\", \"2035-01-01T00:00:00\", \"203…\n$ `_raw_source`       <chr> \"Existing Corporate Structure Data\", \"Existing Cor…\n$ `_algorithm`        <chr> \"Automatic Import\", \"Automatic Import\", \"Automatic…\n$ id                  <chr> \"Abbott, Mcbride and Edwards\", \"Abbott-Gomez\", \"Ab…\n$ dob                 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n```\n\n\n:::\n:::\n\n\n### 2.3 Data Filter\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges_filt <- mc3_edges %>% select(type, source, target)\nglimpse(mc3_edges_filt)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 75,817\nColumns: 3\n$ type   <chr> \"Event.Owns.Shareholdership\", \"Event.Owns.Shareholdership\", \"Ev…\n$ source <chr> \"Avery Inc\", \"Berger-Hayes\", \"Bowers Group\", \"Bowman-Howe\", \"Bo…\n$ target <chr> \"Allen, Nichols and Thompson\", \"Jensen, Morris and Downs\", \"Bar…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes_filt <- mc3_nodes %>% select(type, id)\nglimpse(mc3_nodes_filt)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,520\nColumns: 2\n$ type <chr> \"Entity.Organization.Company\", \"Entity.Organization.Company\", \"En…\n$ id   <chr> \"Abbott, Mcbride and Edwards\", \"Abbott-Gomez\", \"Abbott-Harrison\",…\n```\n\n\n:::\n:::\n\n### 2.4 Edges & Nodes Explore\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(mc3_edges_filt)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |               |\n|:------------------------|:--------------|\n|Name                     |mc3_edges_filt |\n|Number of rows           |75817          |\n|Number of columns        |3              |\n|_______________________  |               |\n|Column type frequency:   |               |\n|character                |3              |\n|________________________ |               |\n|Group variables          |None           |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|type          |         0|             1|  14|  31|     0|        4|          0|\n|source        |         0|             1|   6|  42|     0|    51996|          0|\n|target        |         0|             1|   6|  48|     0|     8926|          0|\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- ggplot(data = mc3_edges_filt, aes(x = type, fill = type)) +\n  geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))\np1\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(mc3_nodes_filt)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |               |\n|:------------------------|:--------------|\n|Name                     |mc3_nodes_filt |\n|Number of rows           |60520          |\n|Number of columns        |2              |\n|_______________________  |               |\n|Column type frequency:   |               |\n|character                |2              |\n|________________________ |               |\n|Group variables          |None           |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|type          |         0|             1|  13|  36|     0|        8|          0|\n|id            |         0|             1|   6|  48|     0|    60520|          0|\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- ggplot(data = mc3_nodes_filt, aes(x = type, fill = type)) +\n  geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))\np2 \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n:::callout-tip\nAccording to the VAST2024 - MC3 Data Description, the person node include Entity.Person and Entity.Person.CEO, the other were included in the Company.\n:::\n\n## 3 MC3 Task(3) \n\nDevelop a visual approach to examine inferences. Infer how the influence of a company changes through time. Can you infer ownership and influence that a network may have?\n\n::: callout-tip\nBased on this task, we need to check the inferences, and how the company changes through time, so the edge types like {Shareholdership, BeneficialOwnership, WorksFor, FamilyRelationship} will be used, and the company name to define company; Meanwhile, the type in node like (Entity.Organization, Entity.Organization.Company, Entity.Organization.FishingCompany, Entity.Organization.LogisticsCompany, Entity.Organization.NewsCompany, Entity.Organization.FinancialCompany, Entity.Organization.NGO) will be used, source and target will be choosed to decide the \"from\" and \"to\".\n:::\n\n### 3.1 Relationship\n\n#### 3.1.1 Nodes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes_clean <- as_tibble(mc3_data$nodes) %>%\n  mutate(type = as.character(type),\n         id = as.character(id)) %>%\n  select(id, type)\nkable(head(mc3_nodes_clean))\n```\n\n::: {.cell-output-display}\n\n\n|id                          |type                        |\n|:---------------------------|:---------------------------|\n|Abbott, Mcbride and Edwards |Entity.Organization.Company |\n|Abbott-Gomez                |Entity.Organization.Company |\n|Abbott-Harrison             |Entity.Organization.Company |\n|Abbott-Ibarra               |Entity.Organization.Company |\n|Abbott-Sullivan             |Entity.Organization.Company |\n|Acevedo and Sons            |Entity.Organization.Company |\n\n\n:::\n:::\n\n\n#### 3.1.2 Edges\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges_clean <- as_tibble(mc3_data$links) %>% \n  distinct() %>%\n  mutate(source = as.character(source),\n         target = as.character(target),\n         type = as.character(type)) %>%\n  group_by(source, target, type) %>%\n    summarise(weights = n()) %>%\n  filter(source!=target) %>%\n  ungroup()\nkable(head(mc3_edges_clean))\n```\n\n::: {.cell-output-display}\n\n\n|source                 |target                               |type                           | weights|\n|:----------------------|:------------------------------------|:------------------------------|-------:|\n|4. SeaCargo Ges.m.b.H. |Dry CreekRybachit Marine A/S         |Event.Owns.Shareholdership     |       1|\n|4. SeaCargo Ges.m.b.H. |KambalaSea Freight Inc               |Event.Owns.Shareholdership     |       1|\n|9. RiverLine CJSC      |SumacAmerica Transport GmbH & Co. KG |Event.Owns.Shareholdership     |       1|\n|Aaron Acosta           |Manning-Pratt                        |Event.Owns.Shareholdership     |       1|\n|Aaron Acosta           |Manning-Pratt                        |Event.WorksFor                 |       1|\n|Aaron Allen            |Hicks-Calderon                       |Event.Owns.BeneficialOwnership |       1|\n\n\n:::\n:::\n\n\n### 3.2 Visualising network graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_graph <- tbl_graph(nodes = mc3_nodes_clean,\n                       edges = mc3_edges_clean,\n                       directed = FALSE) %>%\n  mutate(betweenness_centrality = centrality_betweenness(),\n         closeness_centrality = centrality_closeness())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\nmc3_graph %>%\n  filter(betweenness_centrality >= 8000000) %>%\nggraph(layout = \"fr\") +\n  geom_edge_link(aes(#width= weights,\n                     alpha=0.5)) +\n  geom_node_point(aes(\n    size = betweenness_centrality,\n    color = type,\n    alpha = 0.3)) +\n  geom_node_label(aes(label = id),repel=TRUE, size=2.5, alpha = 0.8) +\n  scale_size_continuous(range=c(1,10)) +\n  theme_graph() +\n  labs(title = 'Initial network visualisation',\n       subtitle = 'Entities with betweenness scores > 8,000,000')\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nBelow is a dataframe showing us the top 10 entities with the highest betweenness scores.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_graph %>%  activate(nodes) %>%  as_tibble() %>% arrange(desc(betweenness_centrality)) %>% slice(1:10) %>% kable() \n```\n\n::: {.cell-output-display}\n\n\n|id                          |type                                 | betweenness_centrality| closeness_centrality|\n|:---------------------------|:------------------------------------|----------------------:|--------------------:|\n|Sharon Moon                 |Entity.Person                        |               30681485|              3.5e-06|\n|Steven Robertson            |Entity.Person                        |               29237593|              3.1e-06|\n|Hart Ltd                    |Entity.Organization.FinancialCompany |               27532594|              3.1e-06|\n|Johnson, Morales and Castro |Entity.Organization.Company          |               26615081|              3.5e-06|\n|Abbott-Harrison             |Entity.Organization.Company          |               24715901|              2.9e-06|\n|Morrison-Zamora             |Entity.Organization.Company          |               22116507|              3.5e-06|\n|Phelps, Montoya and Barnett |Entity.Organization.Company          |               21052612|              2.9e-06|\n|Holloway-Salas              |Entity.Organization.Company          |               20760807|              3.6e-06|\n|Michael Howard DDS          |Entity.Person                        |               20285433|              3.4e-06|\n|Mills, Atkinson and Chavez  |Entity.Organization.Company          |               20119719|              3.0e-06|\n\n\n:::\n:::\n\n\n### 3.2 Building network model with tidygraph\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# mc3_graph <- tbl_graph(nodes = mc3_nodes_filt,\n# edges = mc3)\n```\n:::\n\n\n### 3.3\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Load JSON data\n# # Create igraph object\n# nodes <- mc3_data$nodes\n# edges <- mc3_data$links\n# g <- graph_from_data_frame(d = edges, vertices = nodes, directed = TRUE)\n# # Basic network plot\n# plot(g, vertex.label = NA, vertex.size = 5, edge.arrow.size = 0.5)\n```\n:::\n\n\n## 4. Conclusion\n\n## 5. Reference",
    "supporting": [
      "Take-home_Ex03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}