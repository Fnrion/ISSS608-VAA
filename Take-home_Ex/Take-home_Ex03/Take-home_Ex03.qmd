---
title: "Take_home_Ex03"
author: "Zou Jiaxun"
date: "Jun 7, 2024"
data-modified: "last-modified"
execute: 
  eval: true
  echo: true
  warning: false
  freeze: true
---
# Vast Challenge 2024 Mini-Challenge 3

In rhis challenge, I will attempt to do the following:

- 1. Use visual analytics to identify the influence of current fish company 

- 2. Based on the vosialization on Network, pick the most famous conpmay

## 1 Getting Start

### 1.1 Package Preparation

```{r}
pacman::p_load(tidyverse, readtext, skimr, knitr,
               quanteda, tidytext, jsonlite, dplyr,
               tidyr, tidygraph, ggraph, igraph,
               visNetwork, ggplot2, gganimate, gridExtra)
```

## 2 Data Wangling

### 2.1 Data Import

```{r}
mc3_data <- fromJSON("data/MC3/mc3 1.json")
class(mc3_data)
```

### 2.2 Data Check

```{r}
mc3_edges <- as_tibble(mc3_data$link)
glimpse(mc3_edges)
```

```{r}
mc3_nodes <- as_tibble(mc3_data$nodes)
glimpse(mc3_nodes)
```

### 2.3 Data Filter

```{r}
mc3_edges_filt <- mc3_edges %>% select(type, source, target)
glimpse(mc3_edges_filt)
```

```{r}
mc3_nodes_filt <- mc3_nodes %>% select(type, id)
glimpse(mc3_nodes_filt)
```
### 2.4 Edges & Nodes Explore

```{r}
skim(mc3_edges_filt)
```



```{r}
p1 <- ggplot(data = mc3_edges_filt, aes(x = type, fill = type)) +
  geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
p1
```

```{r}
skim(mc3_nodes_filt)
```

```{r}
p2 <- ggplot(data = mc3_nodes_filt, aes(x = type, fill = type)) +
  geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
p2 
```

:::callout-tip
According to the VAST2024 - MC3 Data Description, the person node include Entity.Person and Entity.Person.CEO, the other were included in the Company.
:::

## 3 MC3 Task(3) 

Develop a visual approach to examine inferences. Infer how the influence of a company changes through time. Can you infer ownership and influence that a network may have?

::: callout-tip
Based on this plot, the edge types like {Shareholdership, BeneficialOwnership, WorksFor, FamilyRelationship} will be used, and the company name to define company; Meanwhile, the type in node like (Entity.Organization, Entity.Organization.Company, Entity.Organization.FishingCompany, Entity.Organization.LogisticsCompany, Entity.Organization.NewsCompany, Entity.Organization.FinancialCompany, Entity.Organization.NGO) will be used, source and target will be choosed to decide the "from" and "to".
:::

### 3.1 Relationship

#### 3.1.1 Nodes

The code chunk below will be used to extract the nodes data.frame of mc3_data and save it as a tibble data.frame called mc3_nodes.

```{r} 
mc3_nodes_clean <- as_tibble(mc3_data$nodes) %>%
  mutate(type = as.character(type),
         id = as.character(id)) %>%
  select(id, type)
kable(head(mc3_nodes_clean))
```

#### 3.1.2 Edges

The code chunk below will be used to extract the links data.frame of mc3_data and save it as a tibble data.frame called mc3_edges.

```{r}
mc3_edges_clean <- as_tibble(mc3_data$links) %>% 
  distinct() %>%
  mutate(source = as.character(source),
         target = as.character(target),
         type = as.character(type)) %>%
  group_by(source, target, type) %>%
    summarise(weights = n()) %>%
  filter(source!=target) %>%
  ungroup()
kable(head(mc3_edges_clean))
```

### 3.2 Visualising network graph

```{r}
mc3_graph <- tbl_graph(nodes = mc3_nodes_clean,
                       edges = mc3_edges_clean,
                       directed = FALSE) %>%
  mutate(betweenness_centrality = centrality_betweenness(),
         closeness_centrality = centrality_closeness())
```

```{r}
set.seed(1234)
mc3_graph %>%
  filter(betweenness_centrality >= 8000000) %>%
ggraph(layout = "fr") +
  geom_edge_link(aes(#width= weights,
                     alpha=0.5)) +
  geom_node_point(aes(
    size = betweenness_centrality,
    color = type,
    alpha = 0.3)) +
  geom_node_label(aes(label = id),repel=TRUE, size=2.5, alpha = 0.8) +
  scale_size_continuous(range=c(1,10)) +
  theme_graph() +
  labs(title = 'Initial network visualisation',
       subtitle = 'Entities with betweenness scores > 8,000,000')
```

Below is a dataframe showing us the top 10 entities with the highest betweenness scores.

```{r}
mc3_graph %>%  activate(nodes) %>%  as_tibble() %>% arrange(desc(betweenness_centrality)) %>% slice(1:10) %>% kable() 
```

### 3.2 Building network model with tidygraph

```{r}
# mc3_graph <- tbl_graph(nodes = mc3_nodes_filt,
# edges = mc3)
```

### 3.3

```{r}
# # Load JSON data
# # Create igraph object
# nodes <- mc3_data$nodes
# edges <- mc3_data$links
# g <- graph_from_data_frame(d = edges, vertices = nodes, directed = TRUE)
# # Basic network plot
# plot(g, vertex.label = NA, vertex.size = 5, edge.arrow.size = 0.5)
```

## 4. Conclusion

## 5. Reference